<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®å¤„ç†å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            width: 100%;
            margin: 20px;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.07);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-top: 0;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        textarea, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            box-sizing: border-box; /* å…³é”® */
            font-size: 16px;
            font-family: "Courier New", Courier, monospace;
        }
        textarea {
            resize: vertical;
            min-height: 150px;
        }
        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }
        .control-row > div {
            flex: 1;
        }
        button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #3498db;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #2980b9;
        }
        #results {
            margin-top: 30px;
            border-top: 2px solid #e0e0e0;
            padding-top: 20px;
        }
        #results h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        #results p {
            margin: 10px 0;
            font-size: 1.1em;
            background-color: #ecf0f1;
            padding: 12px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
        }
        #results p strong {
            color: #2c3e50;
        }
        #results p span {
            font-weight: bold;
            color: #2980b9;
            font-family: "Courier New", Courier, monospace;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
            text-align: center;
        }
        #rel-error-p {
            background-color: #fcf3f3;
        }
        #rel-error-p strong {
            color: #c0392b;
        }
        #rel-error-p span {
            color: #e74c3c;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ“Š æ•°æ®å¤„ç†å·¥å…·</h1>

        <div class="input-group">
            <label for="dataInput">è¾“å…¥æ•°æ® (ç”¨é€—å·, ç©ºæ ¼, æˆ–æ¢è¡Œç¬¦åˆ†éš”):</label>
            <textarea id="dataInput" rows="10" placeholder="ä¾‹å¦‚: 1.02, 1.05, 1.03, 1.04"></textarea>
        </div>

        <div class="control-row">
            <div>
                <label for="theoreticalValue">ç†è®ºå€¼ (é€‰å¡«, ç”¨äºè®¡ç®—ç›¸å¯¹è¯¯å·®):</label>
                <input type="number" id="theoreticalValue" step="any" placeholder="ä¾‹å¦‚: 1.00">
            </div>
            <div>
                <label for="sigFigs">æŒ‡å®šæœ‰æ•ˆä½æ•°:</label>
                <input type="number" id="sigFigs" value="4" min="1">
            </div>
        </div>

        <button id="calculateBtn">å¼€å§‹è®¡ç®—</button>

        <div id="results">
            <h2>è®¡ç®—ç»“æœ</h2>
            <div id="results-output">
                <p><strong>æ•°æ®ç‚¹ä¸ªæ•° (n):</strong> <span id="res-n">---</span></p>
                <p><strong>å¹³å‡å€¼ ($\bar{x}$):</strong> <span id="res-avg">---</span></p>
                <p><strong>æ–¹å‡æ ¹ (RMS):</strong> <span id="res-rms">---</span></p>
                <p><strong>å¹³å‡åå·® (AD):</strong> <span id="res-ad">---</span></p>
                <p><strong>ç›¸å¯¹å¹³å‡åå·® (RAD):</strong> <span id="res-rad">---</span></p>
                <p><strong>æ ·æœ¬æ ‡å‡†åå·® (s):</strong> <span id="res-s">---</span></p>
                <p><strong>ç›¸å¯¹æ ‡å‡†åå·® (RSD):</strong> <span id="res-rsd">---</span></p>
                <p><strong>Aç±»ä¸ç¡®å®šåº¦ ($u_A = s_{\bar{x}}$):</strong> <span id="res-ua">---</span></p>
                <p><strong>ç›¸å¯¹Aç±»ä¸ç¡®å®šåº¦ ($u_A / \bar{x}$):</strong> <span id="res-rua">---</span></p>
                <p id="rel-error-p" style="display:none;"><strong>ç›¸å¯¹è¯¯å·® (RE):</strong> <span id="res-re">---</span></p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('calculateBtn').addEventListener('click', function() {
            const outputDiv = document.getElementById('results-output');
            
            // 1. è·å–è¾“å…¥
            const dataStr = document.getElementById('dataInput').value;
            const theoryValStr = document.getElementById('theoreticalValue').value;
            const sigFigs = parseInt(document.getElementById('sigFigs').value) || 4;

            // 2. è§£ææ•°æ®
            const data = dataStr.trim()
                                .split(/[\s,]+/) // æŒ‰ç©ºæ ¼ã€é€—å·æˆ–æ¢è¡Œç¬¦åˆ†å‰²
                                .filter(Boolean)       // ç§»é™¤ç©ºå­—ç¬¦ä¸²
                                .map(Number)         // è½¬æ¢ä¸ºæ•°å­—
                                .filter(n => !isNaN(n)); // ç§»é™¤æ— æ•ˆæ•°å­— (NaN)

            // 3. æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
            const n = data.length;
            if (n === 0) {
                outputDiv.innerHTML = '<p class="error">é”™è¯¯ï¼šè¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®ç‚¹ã€‚</p>';
                return;
            }

            // 4. å®šä¹‰æ ¼å¼åŒ–å‡½æ•°
            function format(num, sf) {
                if (typeof num !== 'number' || isNaN(num)) {
                    return num; // å¦‚æœæ˜¯ "N/A" ä¹‹ç±»çš„å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›
                }
                return num.toPrecision(sf);
            }
            
            function formatPercent(num, sf) {
                if (typeof num !== 'number' || isNaN(num)) {
                    return num; // "N/A"
                }
                return `${(num * 100).toPrecision(sf)}%`;
            }

            // 5. æ‰§è¡Œè®¡ç®—
            const sum = data.reduce((acc, val) => acc + val, 0);
            const avg = sum / n;
            
            const sumSq = data.reduce((acc, val) => acc + val * val, 0);
            const rms = Math.sqrt(sumSq / n);

            const sumAbsDev = data.reduce((acc, val) => acc + Math.abs(val - avg), 0);
            const ad = sumAbsDev / n; // å¹³å‡åå·®
            const rad = (Math.abs(avg) === 0) ? NaN : (ad / Math.abs(avg)); // ç›¸å¯¹å¹³å‡åå·®

            let s, rsd, ua, rua;
            if (n > 1) {
                const sumSqrDev = data.reduce((acc, val) => acc + Math.pow(val - avg, 2), 0);
                s = Math.sqrt(sumSqrDev / (n - 1)); // æ ·æœ¬æ ‡å‡†åå·®
                rsd = (Math.abs(avg) === 0) ? NaN : (s / Math.abs(avg)); // ç›¸å¯¹æ ‡å‡†åå·®
                ua = s / Math.sqrt(n); // Aç±»ä¸ç¡®å®šåº¦ (å³å¹³å‡å€¼çš„æ ‡å‡†åå·®)
                rua = (Math.abs(avg) === 0) ? NaN : (ua / Math.abs(avg)); // ç›¸å¯¹Aç±»ä¸ç¡®å®šåº¦
            } else {
                s = 'N/A (n<2)';
                rsd = 'N/A (n<2)';
                ua = 'N/A (n<2)';
                rua = 'N/A (n<2)';
            }

            // 6. å¡«å……ç»“æœ
            // é‡ç½®å†…å®¹
            outputDiv.innerHTML = `
                <p><strong>æ•°æ®ç‚¹ä¸ªæ•° (n):</strong> <span id="res-n">---</span></p>
                <p><strong>å¹³å‡å€¼ ($\bar{x}$):</strong> <span id="res-avg">---</span></p>
                <p><strong>æ–¹å‡æ ¹ (RMS):</strong> <span id="res-rms">---</span></p>
                <p><strong>å¹³å‡åå·® (AD):</strong> <span id="res-ad">---</span></p>
                <p><strong>ç›¸å¯¹å¹³å‡åå·® (RAD):</strong> <span id="res-rad">---</span></p>
                <p><strong>æ ·æœ¬æ ‡å‡†åå·® (s):</strong> <span id="res-s">---</span></p>
                <p><strong>ç›¸å¯¹æ ‡å‡†åå·® (RSD):</strong> <span id="res-rsd">---</span></p>
                <p><strong>Aç±»ä¸ç¡®å®šåº¦ ($u_A = s_{\bar{x}}$):</strong> <span id="res-ua">---</span></p>
                <p><strong>ç›¸å¯¹Aç±»ä¸ç¡®å®šåº¦ ($u_A / \bar{x}$):</strong> <span id="res-rua">---</span></p>
                <p id="rel-error-p" style="display:none;"><strong>ç›¸å¯¹è¯¯å·® (RE):</strong> <span id="res-re">---</span></p>
            `;

            document.getElementById('res-n').textContent = n;
            document.getElementById('res-avg').textContent = format(avg, sigFigs);
            document.getElementById('res-rms').textContent = format(rms, sigFigs);
            document.getElementById('res-ad').textContent = format(ad, sigFigs);
            document.getElementById('res-rad').textContent = formatPercent(rad, sigFigs);
            document.getElementById('res-s').textContent = format(s, sigFigs);
            document.getElementById('res-rsd').textContent = formatPercent(rsd, sigFigs);
            document.getElementById('res-ua').textContent = format(ua, sigFigs);
            document.getElementById('res-rua').textContent = formatPercent(rua, sigFigs);

            // 7. å¤„ç†ç†è®ºå€¼å’Œç›¸å¯¹è¯¯å·®
            const theoryVal = parseFloat(theoryValStr);
            const relErrorEl = document.getElementById('rel-error-p');
            
            if (!isNaN(theoryVal) && theoryValStr.trim() !== '') {
                let re, re_text;
                if (Math.abs(theoryVal) === 0) {
                    re_text = 'N/A (ç†è®ºå€¼ä¸º0)';
                } else {
                    re = Math.abs(avg - theoryVal) / Math.abs(theoryVal);
                    re_text = formatPercent(re, sigFigs);
                }
                document.getElementById('res-re').textContent = re_text;
                relErrorEl.style.display = 'flex';
            } else {
                relErrorEl.style.display = 'none';
            }
        });
    </script>

</body>
</html>
